<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<style>
    #topText {
        font-size: 25px;
    }
    .predResult {
        width: 20px;
    }
</style>
</head>
<body>
<div id="topDiv">
    <span id='topText'>숫자야구게임</span>
<input type="button" id="newGameBtn" value="NEW GAME">
<!--
rule
1. 공격 횟수는 6번 (6번 안에 3스트라이크면 승리)
2. 정답 숫자는 중복 되지 않는다
3. 첫번째 자리 숫자는 0이 될 수 없다
4. 숫자와 자리가 맞으면 스트라이크
5. 숫자는 맞고 자리가 다르면 볼
#숫자만입력가능함
 -->
<br/>
<div id="contentDiv" style="display:none;">
<input class="predResult" name="predResult" type="text" value="" maxlength="1" numberonly="true">
<input class="predResult"name="predResult" type="text" value="" maxlength="1" numberonly="true">
<input class="predResult"name="predResult" type="text" value="" maxlength="1" numberonly="true">
<input id="swingBtn" type="button" value="swing">
<br/>
<table>
    <thead>
        <th>도전</th>
        <th>입력숫자</th>
        <th>결과</th>
    </thead>
    <tbody id="resultList">
    </tbody>
</table>
</div>
<script type="text/javascript">

    var result = [];  //정답 3자리 담길 변수
    var predResult = [];  //예상 정답 3자리 담길 변수
    var strikeCnt = 0;  //strike수
    var ballCnt = 0;  //ball수
    var swingCnt = 0;  //swing수
    
    //게임 초기화
    function settingResult(){
        $('#contentDiv').show(200);
        result = [];  //정답 3자리 담길 변수
        predResult = [];  //예상 정답 3자리 담길 변수
        strikeCnt = 0;  //strike수
        ballCnt = 0;  //ball수
        swingCnt = 0;  //swing수
        $('#resultList').children().remove();  //결과리스트삭제
        $('[name=predResult]').each(function(idx){  //예상 정답 텍스트 삭제
            $(this).val('');
        });
        for(var i=0; i<3; i++){
            var resultEle = Math.floor(Math.random() * 10);
            while(i==0 && resultEle==0){
                resultEle = Math.floor(Math.random() * 10);
            };
            while(i==1 && resultEle==result[0]){
                resultEle = Math.floor(Math.random() * 10);
            };
            while(i==2 && resultEle==result[0] || resultEle==result[1]){
                resultEle = Math.floor(Math.random() * 10);
            };
                result.push(resultEle.toString());
        };
    }

    //swing check
    function swingCheck(){
        //입력한 예상답변 배열 담기
        $('[name=predResult]').each(function(idx){
            var value = $(this).val();
            predResult.push(value);
        });

        //예상답변 검사
        for(i=0; i<3; i++){
            if(predResult[i] == result[i]){
                strikeCnt += 1;
            }else{
                if($.inArray(predResult[i], result) != -1){
                    ballCnt += 1;
                };
            };
        };

        if(strikeCnt==3){
            //game success . and add init process
            alert("HOMERUN~! 세게임을 시작합니다.");
            settingResult();
        }else if(swingCnt==5){
            alert("아웃! 새게임을 시작합니다.");
            settingResult();
        }else{
            //도전실패
            swingCnt += 1;
            ;
            $('#swingCntPlace').text(swingCnt);
            var html = "<tr><td>"+swingCnt+"</td>";
            html += "<td>"+predResult+"</td>"
            html += "<td>"+strikeCnt+"Strike"+ballCnt+"Ball</td></tr>";
            $('#resultList').append(html);
        };
        strikeCnt = 0;
        ballCnt = 0;
        predResult = [];
    };

 
    $(document).ready(function(){
        
        //숫자만입력가능
        $(document).on("keyup", "input:text[numberOnly]", function() {
            $(this).val( $(this).val().replace(/[^0-9]/gi,"") );
        });
        //상단 문구 설정

        $('#newGameBtn').click(function(){
            settingResult();
        });

        $('#swingBtn').click(function(){
            var flag = "Y";
            var predResult = [];
            //같은 숫자 입력 방지
            $('[name=predResult]').each(function(idx){
                var value = $(this).val();
                var resultIndex = predResult.indexOf(value);
                if(resultIndex === -1 ){
                }else{
                    flag = "N";
                }
                predResult.push(value);
            });
            if(flag == "Y"){
                swingCheck();
            }else{
                alert("같은 숫자를 입력할 수 없습니다.");
            }
        });

    });

</script> 
</body>
</html>